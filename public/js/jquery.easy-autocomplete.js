/*
 * easy-autocomplete
 * jQuery plugin for autocompletion
 * 
 * @author Łukasz Pawełczak (http://github.com/pawelczak)
 * @version 1.3.5
 * Copyright  License: 
 */
var EasyAutocomplete=function(e){return e.Configuration=function(e){function t(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,n){return t=e.getValue(t),n=e.getValue(n),t<n?-1:t>n?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(e,t){return e.search(t)>-1}),e.categories!==undefined&&e.categories instanceof Array){for(var t=[],n=0,i=e.categories.length;n<i;n+=1){var a=e.categories[n];for(var o in s.categories[0])a[o]===undefined&&(a[o]=s.categories[0][o]);t.push(a)}e.categories=t}}function n(){function t(e,n){var i=e||{};for(var a in e)n[a]!==undefined&&null!==n[a]&&("object"!=typeof n[a]||n[a]instanceof Array?i[a]=n[a]:t(e[a],n[a]));return n.data!==undefined&&null!==n.data&&"object"==typeof n.data&&(i.data=n.data),i}s=t(s,e)}function i(){if("list-required"!==s.url&&"function"!=typeof s.url){var t=s.url;s.url=function(){return t}}if(s.ajaxSettings.url!==undefined&&"function"!=typeof s.ajaxSettings.url){var t=s.ajaxSettings.url;s.ajaxSettings.url=function(){return t}}if("string"==typeof s.listLocation){var n=s.listLocation;"XML"===s.dataType.toUpperCase()?s.listLocation=function(e){return $(e).find(n)}:s.listLocation=function(e){return e[n]}}if("string"==typeof s.getValue){var i=s.getValue;s.getValue=function(e){return e[i]}}e.categories!==undefined&&(s.categoriesAssigned=!0)}function a(){e.ajaxSettings!==undefined&&"object"==typeof e.ajaxSettings?s.ajaxSettings=e.ajaxSettings:s.ajaxSettings={}}function o(e){return s[e]!==undefined&&null!==s[e]}function r(e,t){function n(t,i){for(var a in i)t[a]===undefined&&e.log("Property '"+a+"' does not exist in EasyAutocomplete options API."),"object"==typeof t[a]&&-1===$.inArray(a,u)&&n(t[a],i[a])}n(s,t)}var s={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return e=s.getValue(e),t=s.getValue(t),e<t?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e.search(t)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},u=["ajaxSettings","template"];this.get=function(e){return s[e]},this.equals=function(e,t){return!(!o(e)||s[e]!==t)},this.checkDataUrlProperties=function(){return"list-required"!==s.url||"list-required"!==s.data},this.checkRequiredProperties=function(){for(var e in s)if("required"===s[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,t){r(e,t)},t(),n(),!0===s.loggerEnabled&&r(console,e),a(),i()},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Constans=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(t){return e[t]}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function n(t,n){function i(){var i,a={};return t.xmlElementName!==undefined&&(a.xmlElementName=t.xmlElementName),t.listLocation!==undefined?i=t.listLocation:e.get("listLocation")!==undefined&&(i=e.get("listLocation")),i!==undefined?"string"==typeof i?a.data=$(n).find(i):"function"==typeof i&&(a.data=i(n)):a.data=n,a}function a(){var e={};return t.listLocation!==undefined?"string"==typeof t.listLocation?e.data=n[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(n)):e.data=n,e}var o={};if(o="XML"===e.get("dataType").toUpperCase()?i():a(),t.header!==undefined&&(o.header=t.header),t.maxNumberOfElements!==undefined&&(o.maxNumberOfElements=t.maxNumberOfElements),e.get("list").maxNumberOfElements!==undefined&&(o.maxListSize=e.get("list").maxNumberOfElements),t.getValue!==undefined)if("string"==typeof t.getValue){var r=t.getValue;o.getValue=function(e){return e[r]}}else"function"==typeof t.getValue&&(o.getValue=t.getValue);else o.getValue=e.get("getValue");return o}function i(t){var n=[];return t.xmlElementName===undefined&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each(function(){n.push(this)}),n}this.init=function(t){var n=[],i={};return i.data=e.get("listLocation")(t),i.getValue=e.get("getValue"),i.maxListSize=e.get("list").maxNumberOfElements,n.push(i),n},this.updateCategories=function(t,i){if(e.get("categoriesAssigned")){t=[];for(var a=0;a<e.get("categories").length;a+=1){var o=n(e.get("categories")[a],i);t.push(o)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var n=0;n<t.length;n+=1)t[n].data=i(t[n]);return t},this.processData=function(n,i){for(var a=0,o=n.length;a<o;a+=1)n[a].data=t(e,n[a],i);return n},this.checkIfDataExists=function(e){for(var t=0,n=e.length;t<n;t+=1)if(e[t].data!==undefined&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.proccess=function(t,n,i){function a(e,n){var i=[],a="";if(t.get("list").match.enabled)for(var r=0,s=e.length;r<s;r+=1)a=t.get("getValue")(e[r]),o(a,n)&&i.push(e[r]);else i=e;return i}function o(e,n){return t.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),n=n.toLowerCase()),!!t.get("list").match.method(e,n)}function r(e){return n.maxNumberOfElements!==undefined&&e.length>n.maxNumberOfElements&&(e=e.slice(0,n.maxNumberOfElements)),e}function s(e){return t.get("list").sort.enabled&&e.sort(t.get("list").sort.method),e}e.proccess.match=o;var u=n.data;return u=a(u,i),u=r(u),u=s(u)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},n=function(e){var n,i=e.fields;return"description"===e.type?(n=t.description.method,"string"==typeof i.description?n=function(e,t){return e+" - <span>"+t[i.description]+"</span>"}:"function"==typeof i.description&&(n=function(e,t){return e+" - <span>"+i.description(t)+"</span>"}),n):"iconRight"===e.type?("string"==typeof i.iconSrc?n=function(e,t){return e+"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"}:"function"==typeof i.iconSrc&&(n=function(e,t){return e+"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"}),n):"iconLeft"===e.type?("string"==typeof i.iconSrc?n=function(e,t){return"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"+e}:"function"==typeof i.iconSrc&&(n=function(e,t){return"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"+e}),n):"links"===e.type?("string"==typeof i.link?n=function(e,t){return"<a href='"+t[i.link]+"' >"+e+"</a>"}:"function"==typeof i.link&&(n=function(e,t){return"<a href='"+i.link(t)+"' >"+e+"</a>"}),n):"custom"===e.type?e.method:t.basic.method},i=function(e){return e&&e.type&&e.type&&t[e.type]?n(e):t.basic.method},a=function(e){var n=function(){return""};return e&&e.type&&e.type&&t[e.type]?function(){var n=t[e.type].cssClass;return function(){return n}}():n};this.getTemplateClass=a(e),this.build=i(e)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.main=function(t,n){function i(){return 0===E.length?void p.error("Input field doesn't exist."):m.checkDataUrlProperties()?m.checkRequiredProperties()?(a(),void r()):void p.error("Will not work without mentioned properties."):void p.error("One of options variables 'data' or 'url' must be defined.")}function a(){function e(){var e=$("<div>"),n=g.getValue("WRAPPER_CSS_CLASS");m.get("theme")&&""!==m.get("theme")&&(n+=" eac-"+m.get("theme")),m.get("cssClasses")&&""!==m.get("cssClasses")&&(n+=" "+m.get("cssClasses")),""!==h.getTemplateClass()&&(n+=" "+h.getTemplateClass()),e.addClass(n),E.wrap(e),!0===m.get("adjustWidth")&&t()}function t(){var e=E.outerWidth();E.parent().css("width",e)}function n(){E.unwrap()}function i(){var e=$("<div>").addClass(g.getValue("CONTAINER_CLASS"));e.attr("id",o()).prepend($("<ul>")),function(){e.on("show.eac",function(){switch(m.get("list").showAnimation.type){case"slide":var t=m.get("list").showAnimation.time,n=m.get("list").showAnimation.callback;e.find("ul").slideDown(t,n);break;case"fade":var t=m.get("list").showAnimation.time,n=m.get("list").showAnimation.callback;e.find("ul").fadeIn(t);break;default:e.find("ul").show()}m.get("list").onShowListEvent()}).on("hide.eac",function(){switch(m.get("list").hideAnimation.type){case"slide":var t=m.get("list").hideAnimation.time,n=m.get("list").hideAnimation.callback;e.find("ul").slideUp(t,n);break;case"fade":var t=m.get("list").hideAnimation.time,n=m.get("list").hideAnimation.callback;e.find("ul").fadeOut(t,n);break;default:e.find("ul").hide()}m.get("list").onHideListEvent()}).on("selectElement.eac",function(){e.find("ul li").removeClass("selected"),e.find("ul li").eq(S).addClass("selected"),m.get("list").onSelectItemEvent()}).on("loadElements.eac",function(t,n,i){var a="",o=e.find("ul");o.empty().detach(),A=[];for(var s=0,u=0,l=n.length;u<l;u+=1){var f=n[u].data;if(0!==f.length){n[u].header!==undefined&&n[u].header.length>0&&o.append("<div class='eac-category' >"+n[u].header+"</div>");for(var d=0,g=f.length;d<g&&s<n[u].maxListSize;d+=1)a=$("<li><div class='eac-item'></div></li>"),function(){var e=d,t=s,o=n[u].getValue(f[e]);a.find(" > div").on("click",function(){E.val(o).trigger("change"),S=t,c(t),m.get("list").onClickEvent(),m.get("list").onChooseEvent()}).mouseover(function(){S=t,c(t),m.get("list").onMouseOverEvent()}).mouseout(function(){m.get("list").onMouseOutEvent()}).html(h.build(r(o,i),f[e]))}(),o.append(a),A.push(f[d]),s+=1}}e.append(o),m.get("list").onLoadEvent()})}(),E.after(e)}function a(){E.next("."+g.getValue("CONTAINER_CLASS")).remove()}function r(e,t){return m.get("highlightPhrase")&&""!==t?u(e,t):e}function s(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function u(e,t){var n=s(t);return(e+"").replace(new RegExp("("+n+")","gi"),"<b>$1</b>")}E.parent().hasClass(g.getValue("WRAPPER_CSS_CLASS"))&&(a(),n()),e(),i(),C=$("#"+o()),m.get("placeholder")&&E.attr("placeholder",m.get("placeholder"))}function o(){var e=E.attr("id");return e=g.getValue("CONTAINER_ID")+e}function r(){function e(){y("autocompleteOff",!0)&&g(),t(),n(),i(),a(),o(),r()}function t(){E.focusout(function(){var e,t=E.val();m.get("list").match.caseSensitive||(t=t.toLowerCase());for(var n=0,i=A.length;n<i;n+=1)if(e=m.get("getValue")(A[n]),m.get("list").match.caseSensitive||(e=e.toLowerCase()),e===t)return S=n,void c(S)})}function n(){E.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=m.get("ajaxSettings")||{};for(var n in t)e[n]=t[n];return e}function n(e,t){return!1===m.get("matchResponseProperty")||("string"==typeof m.get("matchResponseProperty")?t[m.get("matchResponseProperty")]===e:"function"!=typeof m.get("matchResponseProperty")||m.get("matchResponseProperty")(t)===e)}if(!(e.length<m.get("minCharNumber"))){if("list-required"!==m.get("data")){var i=m.get("data"),a=v.init(i);a=v.updateCategories(a,i),a=v.processData(a,e),l(a,e),E.parent().find("li").length>0?s():u()}var o=t();o.url!==undefined&&""!==o.url||(o.url=m.get("url")),o.dataType!==undefined&&""!==o.dataType||(o.dataType=m.get("dataType")),o.url!==undefined&&"list-required"!==o.url&&(o.url=o.url(e),o.data=m.get("preparePostData")(o.data,e),$.ajax(o).done(function(t){var i=v.init(t);i=v.updateCategories(i,t),i=v.convertXml(i),n(e,t)&&(i=v.processData(i,e),l(i,e)),v.checkIfDataExists(i)&&E.parent().find("li").length>0?s():u(),m.get("ajaxCallback")()}).fail(function(){p.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:u(),f();break;case 38:e.preventDefault(),A.length>0&&S>0&&(S-=1,E.val(m.get("getValue")(A[S])),c(S));break;case 40:e.preventDefault(),A.length>0&&S<A.length-1&&(S+=1,E.val(m.get("getValue")(A[S])),c(S));break;default:if(e.keyCode>40||8===e.keyCode){var n=E.val();!0!==m.get("list").hideOnEmptyPhrase||8!==e.keyCode||""!==n?m.get("requestDelay")>0?(d!==undefined&&clearTimeout(d),d=setTimeout(function(){t(n)},m.get("requestDelay"))):t(n):u()}}})}function i(){E.on("keydown",function(e){if(e=e||window.event,38===e.keyCode)return suppressKeypress=!0,!1}).keydown(function(e){13===e.keyCode&&S>-1&&(E.val(m.get("getValue")(A[S])),m.get("list").onKeyEnterEvent(),m.get("list").onChooseEvent(),S=-1,u(),e.preventDefault())})}function a(){E.off("keypress")}function o(){E.focus(function(){""!==E.val()&&A.length>0&&(S=-1,s())})}function r(){E.blur(function(){setTimeout(function(){S=-1,u()},250)})}function g(){E.attr("autocomplete","off")}e()}function s(){C.trigger("show.eac")}function u(){C.trigger("hide.eac")}function c(e){C.trigger("selectElement.eac",e)}function l(e,t){C.trigger("loadElements.eac",[e,t])}function f(){E.trigger("blur")}var d,g=new e.Constans,m=new e.Configuration(n),p=new e.Logger,h=new e.Template(n.template),v=new e.ListBuilderService(m,e.proccess),y=m.equals,E=t,C="",A=[],S=-1;e.consts=g,this.getConstants=function(){return g},this.getConfiguration=function(){return m},this.getContainer=function(){return C},this.getSelectedItemIndex=function(){return S},this.getItems=function(){return A},this.getItemData=function(e){return A.length<e||A[e]===undefined?-1:A[e]},this.getSelectedItemData=function(){return this.getItemData(S)},this.build=function(){a()},this.init=function(){i()}},e.eacHandles=[],e.getHandle=function(t){return e.eacHandles[t]},e.inputHasId=function(e){return $(e).attr("id")!==undefined&&$(e).attr("id").length>0},e.assignRandomId=function(t){var n="";do{n="eac-"+Math.floor(1e4*Math.random())}while(0!==$("#"+n).length);elementId=e.consts.getValue("CONTAINER_ID")+n,$(t).attr("id",n)},e.setHandle=function(t,n){e.eacHandles[n]=t},e}(EasyAutocomplete||{});!function(e){e.fn.easyAutocomplete=function(t){return this.each(function(){var n=e(this),i=new EasyAutocomplete.main(n,t);EasyAutocomplete.inputHasId(n)||EasyAutocomplete.assignRandomId(n),i.init(),EasyAutocomplete.setHandle(i,n.attr("id"))})},e.fn.getSelectedItemIndex=function(){var t=e(this).attr("id");return t!==undefined?EasyAutocomplete.getHandle(t).getSelectedItemIndex():-1},e.fn.getItems=function(){var t=e(this).attr("id");return t!==undefined?EasyAutocomplete.getHandle(t).getItems():-1},e.fn.getItemData=function(t){var n=e(this).attr("id");return n!==undefined&&t>-1?EasyAutocomplete.getHandle(n).getItemData(t):-1},e.fn.getSelectedItemData=function(){var t=e(this).attr("id");return t!==undefined?EasyAutocomplete.getHandle(t).getSelectedItemData():-1}}(jQuery);